from typing import Any
from fastapi import APIRouter
from server.logic.session_handler import SessionHandler

router = APIRouter()
s_handler: SessionHandler = SessionHandler()

@router.get("/create/{session_id}")
async def create_session(*, session_id: str) -> Any:
  s_handler.create_session(session_id)
  return f"Created new session {session_id}"

@router.get("/update_entity/{category}/{url}/{amount}")
async def update_entity(*, category: str, url: str, amount: str) -> Any:
  if s_handler:
    s_handler.update_entity(category, url, int(amount))
    return True
  return False

@router.get("/get_recs/{category}")
async def get_recs(*, category: str) -> Any:
  if s_handler:
    return s_handler.get_recs(category)
  return False

@router.post("/image/{image_id}")
async def process_image(*, image_id: str) -> Any:
    res = SessionHandler.current_session.process_image(image_id)
    return res

@router.get("/video/{video_id}")
async def process_video(*, video_id: str) -> Any:
    SessionHandler.current_session.process_video(video_id)
    return True

@router.get("/test")
async def process_video() -> Any:
  return [{"BoundingBox":{"Width":0.20483966171741486,"Height":0.4388907849788666,"Left":0.34575170278549194,"Top":0.21879717707633972},"Emotions":[{"Type":"CALM","Confidence":99.4914779663086},{"Type":"SURPRISED","Confidence":6.2595062255859375},{"Type":"FEAR","Confidence":5.881916522979736},{"Type":"SAD","Confidence":2.222320318222046},{"Type":"ANGRY","Confidence":0.08234016597270966},{"Type":"HAPPY","Confidence":0.0671386569738388},{"Type":"CONFUSED","Confidence":0.06184273958206177},{"Type":"DISGUSTED","Confidence":0.015117590315639973}],"Confidence":99.99932861328125,"Timestamp":"00:00"},{"BoundingBox":{"Width":0.20127733051776886,"Height":0.43393808603286743,"Left":0.34565162658691406,"Top":0.21849676966667175},"Emotions":[{"Type":"HAPPY","Confidence":98.13811492919922},{"Type":"SURPRISED","Confidence":6.295395851135254},{"Type":"FEAR","Confidence":5.903857707977295},{"Type":"SAD","Confidence":2.1963253021240234},{"Type":"CALM","Confidence":0.4821552336215973},{"Type":"CONFUSED","Confidence":0.4738858938217163},{"Type":"DISGUSTED","Confidence":0.4151933491230011},{"Type":"ANGRY","Confidence":0.16306932270526886}],"Confidence":99.99919128417969,"Timestamp":"00:01"},{"BoundingBox":{"Width":0.20427370071411133,"Height":0.44733989238739014,"Left":0.3446379601955414,"Top":0.2157672494649887},"Emotions":[{"Type":"HAPPY","Confidence":96.41755676269531},{"Type":"SURPRISED","Confidence":6.293644905090332},{"Type":"FEAR","Confidence":5.900703430175781},{"Type":"CALM","Confidence":2.699354887008667},{"Type":"SAD","Confidence":2.1900947093963623},{"Type":"DISGUSTED","Confidence":0.22235840559005737},{"Type":"ANGRY","Confidence":0.20665638148784637},{"Type":"CONFUSED","Confidence":0.1587156504392624}],"Confidence":99.99932861328125,"Timestamp":"00:02"},{"BoundingBox":{"Width":0.20690517127513885,"Height":0.446321964263916,"Left":0.3445054292678833,"Top":0.22163026034832},"Emotions":[{"Type":"CALM","Confidence":79.11753845214844},{"Type":"ANGRY","Confidence":6.9752326011657715},{"Type":"SURPRISED","Confidence":6.706831455230713},{"Type":"FEAR","Confidence":6.189026355743408},{"Type":"CONFUSED","Confidence":5.7690205574035645},{"Type":"SAD","Confidence":3.6276724338531494},{"Type":"HAPPY","Confidence":1.8300868272781372},{"Type":"DISGUSTED","Confidence":0.8308678865432739}],"Confidence":99.99960327148438,"Timestamp":"00:03"},{"BoundingBox":{"Width":0.2056557536125183,"Height":0.44725993275642395,"Left":0.3431769609451294,"Top":0.22429029643535614},"Emotions":[{"Type":"CALM","Confidence":87.38703155517578},{"Type":"SURPRISED","Confidence":6.685157775878906},{"Type":"FEAR","Confidence":6.061168670654297},{"Type":"ANGRY","Confidence":3.786062002182007},{"Type":"CONFUSED","Confidence":3.478858709335327},{"Type":"SAD","Confidence":3.0327036380767822},{"Type":"HAPPY","Confidence":1.1118922233581543},{"Type":"DISGUSTED","Confidence":0.427478551864624}],"Confidence":99.9994888305664,"Timestamp":"00:04"},{"BoundingBox":{"Width":0.2043706774711609,"Height":0.4499081075191498,"Left":0.34107667207717896,"Top":0.218052476644516},"Emotions":[{"Type":"CALM","Confidence":99.52405548095703},{"Type":"SURPRISED","Confidence":6.265249252319336},{"Type":"FEAR","Confidence":5.884925365447998},{"Type":"SAD","Confidence":2.2027130126953125},{"Type":"ANGRY","Confidence":0.09146594256162643},{"Type":"CONFUSED","Confidence":0.07065778970718384},{"Type":"HAPPY","Confidence":0.0629187747836113},{"Type":"DISGUSTED","Confidence":0.01281753834336996}],"Confidence":99.99921417236328,"Timestamp":"00:05"},{"BoundingBox":{"Width":0.2022705376148224,"Height":0.4332122504711151,"Left":0.3452412188053131,"Top":0.2146291583776474},"Emotions":[{"Type":"CALM","Confidence":81.81436157226562},{"Type":"SURPRISED","Confidence":6.453090190887451},{"Type":"FEAR","Confidence":6.121138095855713},{"Type":"SAD","Confidence":4.704722881317139},{"Type":"CONFUSED","Confidence":4.691339492797852},{"Type":"ANGRY","Confidence":4.686996936798096},{"Type":"HAPPY","Confidence":1.5299302339553833},{"Type":"DISGUSTED","Confidence":0.55572509765625}],"Confidence":99.99922180175781,"Timestamp":"00:06"},{"BoundingBox":{"Width":0.2055152952671051,"Height":0.45410284399986267,"Left":0.3394257426261902,"Top":0.2192469984292984},"Emotions":[{"Type":"CALM","Confidence":93.42658996582031},{"Type":"SURPRISED","Confidence":6.366779804229736},{"Type":"FEAR","Confidence":5.9517388343811035},{"Type":"SAD","Confidence":2.761990547180176},{"Type":"CONFUSED","Confidence":1.885362148284912},{"Type":"ANGRY","Confidence":1.6221767663955688},{"Type":"HAPPY","Confidence":0.5819312334060669},{"Type":"DISGUSTED","Confidence":0.24390381574630737}],"Confidence":99.9993896484375,"Timestamp":"00:07"},{"BoundingBox":{"Width":0.2079310119152069,"Height":0.4589444100856781,"Left":0.33987507224082947,"Top":0.21748356521129608},"Emotions":[{"Type":"CALM","Confidence":72.2292709350586},{"Type":"CONFUSED","Confidence":9.4747896194458},{"Type":"ANGRY","Confidence":7.906296730041504},{"Type":"SURPRISED","Confidence":6.685983180999756},{"Type":"FEAR","Confidence":6.306666851043701},{"Type":"SAD","Confidence":4.831108570098877},{"Type":"HAPPY","Confidence":1.6298785209655762},{"Type":"DISGUSTED","Confidence":0.9286423325538635}],"Confidence":99.99949645996094,"Timestamp":"00:08"},{"BoundingBox":{"Width":0.2084835171699524,"Height":0.4543765187263489,"Left":0.34133556485176086,"Top":0.22122950851917267},"Emotions":[{"Type":"CALM","Confidence":87.91014862060547},{"Type":"SURPRISED","Confidence":6.520330905914307},{"Type":"FEAR","Confidence":6.077853679656982},{"Type":"SAD","Confidence":3.4284584522247314},{"Type":"ANGRY","Confidence":3.3888492584228516},{"Type":"CONFUSED","Confidence":3.0642249584198},{"Type":"HAPPY","Confidence":0.8625684380531311},{"Type":"DISGUSTED","Confidence":0.34491005539894104}],"Confidence":99.99954986572266,"Timestamp":"00:09"},{"BoundingBox":{"Width":0.20377106964588165,"Height":0.45179885625839233,"Left":0.342670738697052,"Top":0.22170428931713104},"Emotions":[{"Type":"CALM","Confidence":31.849245071411133},{"Type":"CONFUSED","Confidence":24.19330596923828},{"Type":"HAPPY","Confidence":14.362309455871582},{"Type":"ANGRY","Confidence":14.015969276428223},{"Type":"SURPRISED","Confidence":7.110663414001465},{"Type":"FEAR","Confidence":6.426117420196533},{"Type":"SAD","Confidence":5.899929046630859},{"Type":"DISGUSTED","Confidence":5.203719139099121}],"Confidence":99.9993896484375,"Timestamp":"00:10"},{"BoundingBox":{"Width":0.20538149774074554,"Height":0.4548896253108978,"Left":0.34103235602378845,"Top":0.22305327653884888},"Emotions":[{"Type":"CALM","Confidence":53.70234680175781},{"Type":"CONFUSED","Confidence":19.850276947021484},{"Type":"ANGRY","Confidence":10.736045837402344},{"Type":"SURPRISED","Confidence":6.942641735076904},{"Type":"FEAR","Confidence":6.211053371429443},{"Type":"SAD","Confidence":5.475313663482666},{"Type":"HAPPY","Confidence":4.666993618011475},{"Type":"DISGUSTED","Confidence":2.06296968460083}],"Confidence":99.99947357177734,"Timestamp":"00:11"},{"BoundingBox":{"Width":0.20863573253154755,"Height":0.46197909116744995,"Left":0.340340793132782,"Top":0.22257649898529053},"Emotions":[{"Type":"ANGRY","Confidence":77.20927429199219},{"Type":"CONFUSED","Confidence":14.70048713684082},{"Type":"SURPRISED","Confidence":6.441624641418457},{"Type":"FEAR","Confidence":6.0846052169799805},{"Type":"CALM","Confidence":4.211715221405029},{"Type":"SAD","Confidence":2.566570520401001},{"Type":"DISGUSTED","Confidence":1.1170158386230469},{"Type":"HAPPY","Confidence":0.5544081330299377}],"Confidence":99.9993896484375,"Timestamp":"00:12"},{"BoundingBox":{"Width":0.20829199254512787,"Height":0.4637466073036194,"Left":0.34350690245628357,"Top":0.2231786549091339},"Emotions":[{"Type":"ANGRY","Confidence":41.54190444946289},{"Type":"CONFUSED","Confidence":39.029930114746094},{"Type":"CALM","Confidence":9.477676391601562},{"Type":"SURPRISED","Confidence":6.71982479095459},{"Type":"FEAR","Confidence":6.459097385406494},{"Type":"SAD","Confidence":3.7279837131500244},{"Type":"DISGUSTED","Confidence":2.5993306636810303},{"Type":"HAPPY","Confidence":0.9725041389465332}],"Confidence":99.99954986572266,"Timestamp":"00:13"},{"BoundingBox":{"Width":0.20913910865783691,"Height":0.4631316363811493,"Left":0.3426615297794342,"Top":0.22454014420509338},"Emotions":[{"Type":"CONFUSED","Confidence":56.09730911254883},{"Type":"ANGRY","Confidence":31.644594192504883},{"Type":"SURPRISED","Confidence":6.555036544799805},{"Type":"FEAR","Confidence":6.189539432525635},{"Type":"CALM","Confidence":4.632455348968506},{"Type":"SAD","Confidence":3.3342161178588867},{"Type":"DISGUSTED","Confidence":2.4733359813690186},{"Type":"HAPPY","Confidence":0.5701006650924683}],"Confidence":99.99959564208984,"Timestamp":"00:00"}]




